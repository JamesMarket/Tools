# 亚马逊产品图片获取脚本 V2

## 版本特点
- 优化的重定向处理
- 改进的请求头和连接池配置
- 增强的图片URL提取能力
- 完善的错误处理和重试策略
- 标准化的日志输出
- 支持所有亚马逊站点

## 主要改进
1. 重定向处理
   - 自动处理多级重定向
   - 智能URL参数清理
   - 重定向次数限制

2. 请求优化
   - 连接池管理
   - 自适应超时设置
   - 完整的请求头信息
   - 流式请求处理

3. 图片处理
   - 智能选择最高质量图片
   - 多种图片URL提取模式
   - 自动图片尺寸优化
   - 图片有效性验证

4. 错误处理
   - 完善的重试机制
   - 智能延迟策略
   - 异常状态处理
   - 数据完整性保护

## 使用方法
1. 安装依赖：
```bash
pip install seatable-api requests
```

2. 配置SeaTable信息：
```python
server_url = 'https://cloud.seatable.cn'
api_token = '你的API Token'
table_name = 'Task'  # 表格名称
```

3. 运行脚本：
```bash
python get_amazon_images_v2.py
```

## 数据表要求
- 表名：Task
- 必需列：
  - 产品链接：��本类型
  - 产品图片：图片类型

## 支持的站点
- 北美：US, CA, MX
- 欧洲：UK, DE, FR, IT, ES, NL, SE, PL
- 亚太：JP, AU, IN, SG
- 中东：AE, SA
- 南美：BR

## 性能参数
- 单条处理时间：5-15秒
- 重试次数：最多5次
- 连接池大小：10
- 超时设置：连接10秒，读取20秒

## 日志说明
- SUCCESS：操作成功
- ERROR：操作失败
- WARN：警告信息
- INFO：普通信息

## 统计信息
- 更新成功数
- 无需更新数
- 空链接数
- 保留原图数
- 完全失败数
- 总处理时间

## 注意事项
1. 网络环境要求
   - 稳定的网络连接
   - 足够的带宽
   - 合理的代理设置（如需要）

2. 资源消耗
   - CPU使用适中
   - 内存占用稳定
   - 网络连接数可控

3. 运行建议
   - 建议在服务器环境运行
   - 适合长时间运行
   - 支持中断后继续
   - 建议定期检查日志

## 适用场景
- 数据量中等（建议小于2000条）
- 需要高质量图片
- 要求稳定性和可靠性
- 需要详细的执行日志

## 维护建议
1. 定期检查
   - API Token有效性
   - 网络连接状态
   - 日志输出情况
   - 系统资源占用

2. 优化建议
   - 根据网络情况调整超时设置
   - 适当调整重试间隔
   - 必要时调整连接池大小
   - 定期清理日志文件

## 故障排除
1. 连接超时
   - 检查网络状态
   - 调整超时参数
   - 确认代理设置

2. 重定向问题
   - 检查URL格式
   - 确认站点可访问性
   - 查看重定向链路

3. 图片获取失败
   - 验证产品页面可访问性
   - 检查图片提取模式
   - 确认图片URL有效性

4. 更新失败
   - 检查SeaTable连接
   - 确认权限设置
   - 验证数据格式 