# 亚马逊产品图片自动获取脚本

这个脚本用于自动从亚马逊产品页面获取产品主图，并更新到 SeaTable 数据库中。

## 功能特点

- 支持多个亚马逊站点（美国、加拿大、英国、德国、法国、意大利、西班牙、日本等）
- 智能图片质量优化（自动获取最高质量图片）
- 完善的重试机制和错误处理
- 详细的日志输出
- 支持断点续传（保留原有图片）
- 优化的请求策略，避免被封禁
- 历史记录功能，避免重复提取（V3新增）

## 使用方法

1. 确保已安装所需依赖：
```bash
pip install seatable-api requests
```

2. 配置 SeaTable API Token 和服务器地址：
```python
server_url = 'https://cloud.seatable.cn'
api_token = '你的API Token'
```

3. 运行脚本：
```bash
python get_amazon_images_v3.py
```

## 数据表格式要求

SeaTable 表格需要包含以下列：
- `产品链接`：亚马逊产品链接
- `产品图片`：用于存储图片URL的图片类型列

## 更新历史

### V3 版本 (当前版本)
- 添加历史记录功能，避免重复提取
- 使用 JSON 文件存储历史数据
- 优化历史记录的读写性能
- 定期自动保存历史记录
- 统计历史记录使用情况
- 支持历史记录的自动恢复

### V2 版本
- 优化重定向处理
- 改进请求头和连接池配置
- 增强图片URL提取能力
- 优化错误处理和重试策略
- 改进日志输出格式
- 支持所有亚马逊站点

### V1 版本
- 基础功能实现
- 支持主要亚马逊站点
- 基本的错误处理

## 注意事项

1. 请确保网络环境稳定
2. 建议使用代理服务器避免IP被限制
3. 脚本包含随机延迟，处理大量数据可能需要较长时间
4. 默认保留原有图片，避免数据丢失
5. 历史记录文件（amazon_images_history.json）会自动创建在脚本同目录下

## 常见问题

1. 重定向次数过多
   - 已优化处理逻辑，自动处理重定向
   - 清理URL参数，提高成功率

2. 图片质量问题
   - 自动获取最高质量版本
   - 支持多种图片URL模式

3. 请求失败
   - 内置重试机制
   - 随机延迟避免频率限制

4. 历史记录相关
   - 历史记录文件损坏会自动重建
   - 每10条数据自动保存一次
   - 支持程序中断后继续使用历史记录

## 性能参考

- 单条记录处理时间：约5-15秒
- 建议单次处理数据量：不超过2000条
- 预计处理2000条记录耗时：4-12小时（取决于网络环境）
- 使用历史记录可显著提升处理速度

## 维护说明

代码托管在：[仓库地址]
如有问题请提交 Issue 或联系维护者。 